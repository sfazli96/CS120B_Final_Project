/*
 * sfazl001_cs120_Final_project_demo1.c
 *
 * Created: 2/25/2020 4:23:37 PM
 * Author : sfazl001 Sameh Fazli 
 */ 

#include <avr/io.h>
#include "shiftregister_columns.h"
#include "shiftRegister_Rows.h"
#include "timer.h"
#include "io.c"
#include "bit.h"
//#include "snes.c"
#include "scheduler.h"


//#include "Test_For_matrix.h"

#ifdef _SIMULATE_
#endif

typedef struct _lights
{
	uint8_t row;
	uint8_t column;
} lights;

const lights l_list[][8] =
{
	{
		{0x81, 0x01}, 
		{0x42, 0x02},
		{0x24, 0x04},
		{0x18, 0x08},
		{0x10, 0x10},
		{0x20, 0x20},
		{0x40, 0x40},
		{0x80, 0x80}
	},

	{
		{0x02, 0x01},
		{0x04, 0x02},
		{0x08, 0x04},
		{0x10, 0x08},
		{0x20, 0x10},
		{0x40, 0x20},
		{0x80, 0x40},
		{0x00, 0x00}
	},

	{
		{0x04, 0x01},
		{0x08, 0x02},
		{0x10, 0x04},
		{0x20, 0x08},
		{0x40, 0x10},
		{0x80, 0x20},
		{0x00, 0x00},
		{0x00, 0x00}
	},

	{
		{0x08, 0x01},
		{0x10, 0x02},
		{0x20, 0x04},
		{0x40, 0x08},
		{0x80, 0x10},
		{0x00, 0x00},
		{0x00, 0x00},
		{0x00, 0x00}
	},

	{
		{0x10, 0x01},
		{0x20, 0x02},
		{0x40, 0x04},
		{0x80, 0x08},
		{0x00, 0x00},
		{0x00, 0x00},
		{0x00, 0x00},
		{0x00, 0x00}
	},

	{
		{0x20, 0x01},
		{0x40, 0x02},
		{0x80, 0x04},
		{0x00, 0x08},
		{0x00, 0x10},
		{0x00, 0x20},
		{0x00, 0x40},
		{0x00, 0x80}
	},

	{
		{0x40, 0x01},
		{0x80, 0x02},
		{0x00, 0x04},
		{0x00, 0x08},
		{0x00, 0x10},
		{0x00, 0x20},
		{0x00, 0x40},
		{0x00, 0x80}
	},

	{
		{0x80, 0x01},
		{0x00, 0x02},
		{0x00, 0x04},
		{0x00, 0x08},
		{0x00, 0x10},
		{0x00, 0x20},
		{0x00, 0x40},
		{0x00, 0x80}
	},

	{
		{0x00, 0x01},
		{0x00, 0x02},
		{0x00, 0x04},
		{0x00, 0x08},
		{0x00, 0x10},
		{0x00, 0x20},
		{0x00, 0x40},
		{0x00, 0x80}
	},
};

int main(void) {
	//    //output of columns
	    //DDRC = 0xFF;
	    //PORTC = 0x00;
	
	//set port A as output columns
	    //DDRD = 0xFF;
	   // PORTD = 0x00;
	//set period timer
	TimerSet(1);
	//initialize timer
	TimerOn();
	uint8_t i = 0;
	uint8_t j = 0;
	uint16_t k = 0;
	uint8_t state = 0;
	//initialize shift register
	shiftInit();
	shift2Init();
	//SNES_init();
	//LCD_init();
	while (1)
	{
		if(state == 0)
		{
			shift2Write(0xFF);
			shiftWrite(0x00);
			state = 1;
			++i;
		}
		else
		{
			shift2Write(0xFF & (~(l_list[0][i].row)) );
			shiftWrite(0x00 | (l_list[0][i].column));
			state = 0;
		}
		if(i >= 8)
		{
			i = 0;
		}
		if(k < 500)
		{
			++k;
		}
		else
		{
			k=0;
			if(j < 8)
			{
				j++;
			}
			else
			{
				j = 0;
			}
		}
		//shift2Write(0xFF); //& (~(l_list[j][i].row)) );
		//shiftWrite(0x00); //| (l_list[j][i].column));
		//Tick();
		while(!TimerFlag);
		TimerFlag = 0;
	}
	return 0;
	
}



